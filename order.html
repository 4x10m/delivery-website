<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="common.css">
	<link rel="stylesheet" type="text/css" href="order.css">
	<title></title>
	<meta charset="utf8">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
	integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
	crossorigin=""/>

	<script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
	integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
	crossorigin=""></script>
</head>
<body>
	<div id="banner">
		<div id="cardview">
			<div id="header">
				<div id="header-helper">
					<img id="logo" src="logo.PNG">

					<div id="navigation">
						<a href="about.html">A propos</a>
						<a href="signin.html">Connexion</a>
					</div>
				</div>
			</div>

			<form name="order">
			<h1>Commander</h1>

			<h2>Type de prestation</h2>
				<input type="radio" id="choice1" name="order-type-radio" value="Livraison d'objets">
				<label for="choice1">
					<strong>
						Livraison d'objets
					</strong>

					<br>
				
					<em>
						Comprend la récupération d'un objet dans un endroit spécifique et l'acheminement de celui-ci vers un autre endroit.
					</em>
				</label>

				<div class="hidden" id="object-delivery">hidden</div>

				<br>

				<input type="radio" id="choice2" name="order-type-radio" value="Faire une course">
				<label for="choice2">Faire une course</label>

				<br>

				<input type="radio" id="choice3" name="order-type-radio" value="Retour de soirée">

				<br>

				<input type="radio" id="choice4" name="order-type-radio" value="Personalisée">


				<h2>Adresses</h2>

				<input type="text" placeholder="Adresse de départ">
				<input type="text" placeholder="Adresse d'arrivée">

				<div id="map"></div>

				<p>Distance</p>
				<input type="text" placeholder="0">

				<p>Altitude</p>
				<input type="text" placeholder="0">

			<h2>Poids</h2>

			<input type="radio" id="choice4" name="choice-weight" value="1">
			<label for="choice4">0-1kg</label>

				<input type="radio" id="choice4" name="choice-weight" value="1">
				<label for="choice4">0-1kg</label>

				<input type="radio" id="choice4" name="choice-weight" value="2">
				<label for="choice4">1-5kg</label>

				<input type="radio" id="choice4" name="choice-weight" value="3">
				<label for="choice4">5-15kg</label>

				<input type="radio" id="choice4" name="choice-weight" value="4">
				<label for="choice4">+15kg</label>

				<br>

				<label for="weight-cost">Tarif</label>
				<input type="text" name="weight-cost" placeholder="0">

				<h2>Urgence</h2>

				<input type="checkbox" name="Urgence">
				<label for="Urgence">Urgence</label>

				<div id="validate-container">
				</div>
			</form>
		</div>


	</div>

	<script>
    	//https://www.geodatasource.com/developers/javascript
    	function distance(lat1, lon1, lat2, lon2, unit) {
    		var radlat1 = Math.PI * lat1/180
    		var radlat2 = Math.PI * lat2/180
    		var theta = lon1-lon2
    		var radtheta = Math.PI * theta/180
    		var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
    		if (dist > 1) {
    			dist = 1;
    		}
    		dist = Math.acos(dist)
    		dist = dist * 180/Math.PI
			dist = dist * 60 * 1.1515 // Miles
			if (unit=="K") { dist = dist * 1.609344 } // Kilometers
			if (unit=="N") { dist = dist * 0.8684 } // Nautical
				return dist
		}

		function price(distance, factor = 2, ratio = 1.5) {
			var ratio = 1.5;
			var valmin = 15;
			var valeur = 10;
			return Math.pow(distance, factor) * (valmin / Math.pow(valeur, factor));
		}


		var markers = [];
		var map = L.map('map').setView([51.505, -0.09], 13);

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);

		L.marker([51.5, -0.09]).addTo(map)
		.bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
		.openPopup();

		function onMapClick(e) {
			console.log("You clicked the map at " + e.latlng);

			if( markers.length == 0) {
				var marker = L.marker(e.latlng).addTo(map);

				markers.push(marker);
			} else if (markers.length > 0) {
				if (markers.length == 2) {
					var marker = markers.pop();

					map.removeLayer(marker);
				}


				var marker = L.marker(e.latlng).addTo(map);

				markers.push(marker);

				var distance2 = distance(markers[0].getLatLng().lat, markers[0].getLatLng().lng, markers[1].getLatLng().lat, markers[1].getLatLng().lng, "K");
				document.getElementById('distance').textContent = distance2;

				document.getElementById('price').textContent = price(distance2);
			}


		}

		map.on('click', onMapClick);



		var rad = document.forms['order'].elements['choice'];
		var prev = null;
		for(var i = 0; i < rad.length; i++) {
		    rad[i].onchange = function() {
		        console.log(this.value);

		        if (this.value == "Livraison d'objets") {

		        	document.getElementById('object-delivery').classList.remove("hidden");
		        } else {
		        	document.getElementById('object-delivery').classList.add("hidden");
		        }
		    };
		}

	</script>
</body>
</html>